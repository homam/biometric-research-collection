{"id":"obbr","dependencies":[{"name":"/project/home/homam/workspace/node_modules/@supabase/realtime-js/dist/module/lib/push.js.map","includedInParent":true,"mtime":1685174397035},{"name":"/project/home/homam/workspace/node_modules/@supabase/realtime-js/src/lib/push.ts","includedInParent":true,"mtime":1685174397035},{"name":"/project/home/homam/workspace/package.json","includedInParent":true,"mtime":1685174415021},{"name":"/project/home/homam/workspace/node_modules/@supabase/realtime-js/package.json","includedInParent":true,"mtime":1685174397035},{"name":"../lib/constants","loc":{"line":1,"column":32,"index":32},"parent":"/project/home/homam/workspace/node_modules/@supabase/realtime-js/dist/module/lib/push.js","resolved":"/project/home/homam/workspace/node_modules/@supabase/realtime-js/dist/module/lib/constants.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=require(\"../lib/constants\");class t{constructor(t,i,s={},h=e.DEFAULT_TIMEOUT){this.channel=t,this.event=i,this.payload=s,this.timeout=h,this.sent=!1,this.timeoutTimer=void 0,this.ref=\"\",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref=\"\",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived(\"timeout\"))return;this.startTimeout(),this.sent=!0,\"rate limited\"===this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t(null===(i=this.receivedResp)||void 0===i?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger(\"timeout\",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}exports.default=t;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":0}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":13}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":20}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":35}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":43}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":56}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":57}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":64}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":68}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":76}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":89}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":105}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":4,"column":14},"generated":{"line":1,"column":125}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":4,"column":21},"generated":{"line":1,"column":131}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":27,"column":2},"generated":{"line":1,"column":133}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":145}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":29,"column":11},"generated":{"line":1,"column":147}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":30,"column":11},"generated":{"line":1,"column":149}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":30,"column":45},"generated":{"line":1,"column":151}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":31,"column":11},"generated":{"line":1,"column":154}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":31,"column":29},"generated":{"line":1,"column":156}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":31,"column":44},"generated":{"line":1,"column":158}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":175}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":180}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":188}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":29,"column":11},"generated":{"line":1,"column":190}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":29,"column":11},"generated":{"line":1,"column":195}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":29,"column":11},"generated":{"line":1,"column":201}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":30,"column":11},"generated":{"line":1,"column":203}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":30,"column":11},"generated":{"line":1,"column":208}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":30,"column":11},"generated":{"line":1,"column":216}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":31,"column":11},"generated":{"line":1,"column":218}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":31,"column":11},"generated":{"line":1,"column":223}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":31,"column":11},"generated":{"line":1,"column":231}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":5,"column":2},"generated":{"line":1,"column":233}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":5,"column":2},"generated":{"line":1,"column":238}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":5,"column":18},"generated":{"line":1,"column":244}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":6,"column":2},"generated":{"line":1,"column":246}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":6,"column":2},"generated":{"line":1,"column":251}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":6,"column":37},"generated":{"line":1,"column":269}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":271}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":276}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":7,"column":16},"generated":{"line":1,"column":280}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":283}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":288}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":11,"column":13},"generated":{"line":1,"column":301}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":12,"column":2},"generated":{"line":1,"column":306}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":12,"column":2},"generated":{"line":1,"column":311}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":15,"column":8},"generated":{"line":1,"column":320}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":16,"column":2},"generated":{"line":1,"column":323}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":16,"column":2},"generated":{"line":1,"column":328}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":16,"column":28},"generated":{"line":1,"column":337}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":342}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":347}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":17,"column":25},"generated":{"line":1,"column":360}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":34,"column":2},"generated":{"line":1,"column":362}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":34,"column":9},"generated":{"line":1,"column":369}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":1,"column":372}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":35,"column":9},"generated":{"line":1,"column":377}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":35,"column":19},"generated":{"line":1,"column":385}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":36,"column":4},"generated":{"line":1,"column":387}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":36,"column":9},"generated":{"line":1,"column":392}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":1,"column":410}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":37,"column":9},"generated":{"line":1,"column":415}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":37,"column":15},"generated":{"line":1,"column":419}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":38,"column":4},"generated":{"line":1,"column":422}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":38,"column":9},"generated":{"line":1,"column":427}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":38,"column":20},"generated":{"line":1,"column":436}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":39,"column":4},"generated":{"line":1,"column":441}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":39,"column":9},"generated":{"line":1,"column":446}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":39,"column":24},"generated":{"line":1,"column":459}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":40,"column":4},"generated":{"line":1,"column":464}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":40,"column":9},"generated":{"line":1,"column":469}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":40,"column":16},"generated":{"line":1,"column":475}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":41,"column":4},"generated":{"line":1,"column":477}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":41,"column":9},"generated":{"line":1,"column":482}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":44,"column":2},"generated":{"line":1,"column":489}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":45,"column":4},"generated":{"line":1,"column":496}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":45,"column":8},"generated":{"line":1,"column":499}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":45,"column":13},"generated":{"line":1,"column":504}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":45,"column":26},"generated":{"line":1,"column":517}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":46,"column":6},"generated":{"line":1,"column":528}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":48,"column":4},"generated":{"line":1,"column":535}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":48,"column":9},"generated":{"line":1,"column":540}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":49,"column":4},"generated":{"line":1,"column":555}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":49,"column":9},"generated":{"line":1,"column":560}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":49,"column":16},"generated":{"line":1,"column":566}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":57,"column":19},"generated":{"line":1,"column":568}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":50,"column":19},"generated":{"line":1,"column":585}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":50,"column":24},"generated":{"line":1,"column":590}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":50,"column":32},"generated":{"line":1,"column":598}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":50,"column":39},"generated":{"line":1,"column":605}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":50,"column":44},"generated":{"line":1,"column":610}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":51,"column":6},"generated":{"line":1,"column":611}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":51,"column":13},"generated":{"line":1,"column":617}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":51,"column":18},"generated":{"line":1,"column":622}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":51,"column":26},"generated":{"line":1,"column":630}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":52,"column":6},"generated":{"line":1,"column":636}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":52,"column":13},"generated":{"line":1,"column":642}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":52,"column":18},"generated":{"line":1,"column":647}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":53,"column":6},"generated":{"line":1,"column":653}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":53,"column":15},"generated":{"line":1,"column":661}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":53,"column":20},"generated":{"line":1,"column":666}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":54,"column":6},"generated":{"line":1,"column":674}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":54,"column":11},"generated":{"line":1,"column":678}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":54,"column":16},"generated":{"line":1,"column":683}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":1,"column":687}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":55,"column":16},"generated":{"line":1,"column":696}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":55,"column":21},"generated":{"line":1,"column":701}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":55,"column":29},"generated":{"line":1,"column":709}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":58,"column":6},"generated":{"line":1,"column":724}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":58,"column":11},"generated":{"line":1,"column":729}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":58,"column":25},"generated":{"line":1,"column":742}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":62,"column":2},"generated":{"line":1,"column":745}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":62,"column":16},"generated":{"line":1,"column":759}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":4},"generated":{"line":1,"column":762}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":9},"generated":{"line":1,"column":767}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":16},"generated":{"line":1,"column":775}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":16},"generated":{"line":1,"column":782}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":16},"generated":{"line":1,"column":789}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":16},"generated":{"line":1,"column":796}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":16},"generated":{"line":1,"column":803}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":24},"generated":{"line":1,"column":806}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":29},"generated":{"line":1,"column":811}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":63,"column":41},"generated":{"line":1,"column":820}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":66,"column":2},"generated":{"line":1,"column":823}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":66,"column":10},"generated":{"line":1,"column":831}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":66,"column":26},"generated":{"line":1,"column":833}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":836}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":840}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":1,"column":842}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":67,"column":8},"generated":{"line":1,"column":849}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":67,"column":13},"generated":{"line":1,"column":854}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":67,"column":26},"generated":{"line":1,"column":867}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":6},"generated":{"line":1,"column":871}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":32},"generated":{"line":1,"column":873}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":15},"generated":{"line":1,"column":881}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":15},"generated":{"line":1,"column":883}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":20},"generated":{"line":1,"column":888}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":32},"generated":{"line":1,"column":908}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":32},"generated":{"line":1,"column":912}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":32},"generated":{"line":1,"column":919}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":32},"generated":{"line":1,"column":921}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":68,"column":34},"generated":{"line":1,"column":923}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":1,"column":933}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":9},"generated":{"line":1,"column":938}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":18},"generated":{"line":1,"column":947}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":23},"generated":{"line":1,"column":952}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":25},"generated":{"line":1,"column":953}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":25},"generated":{"line":1,"column":960}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":33},"generated":{"line":1,"column":962}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":71,"column":33},"generated":{"line":1,"column":971}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":72,"column":11},"generated":{"line":1,"column":975}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":75,"column":2},"generated":{"line":1,"column":980}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":76,"column":4},"generated":{"line":1,"column":995}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":76,"column":8},"generated":{"line":1,"column":998}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":76,"column":13},"generated":{"line":1,"column":1003}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":77,"column":6},"generated":{"line":1,"column":1016}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":79,"column":4},"generated":{"line":1,"column":1023}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":79,"column":9},"generated":{"line":1,"column":1028}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":79,"column":15},"generated":{"line":1,"column":1032}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":79,"column":20},"generated":{"line":1,"column":1037}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":79,"column":28},"generated":{"line":1,"column":1045}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":79,"column":35},"generated":{"line":1,"column":1052}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":4},"generated":{"line":1,"column":1063}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":9},"generated":{"line":1,"column":1068}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":20},"generated":{"line":1,"column":1077}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":25},"generated":{"line":1,"column":1082}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":33},"generated":{"line":1,"column":1090}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":49},"generated":{"line":1,"column":1106}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":80,"column":54},"generated":{"line":1,"column":1111}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":89,"column":4},"generated":{"line":1,"column":1116}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":89,"column":9},"generated":{"line":1,"column":1121}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":89,"column":17},"generated":{"line":1,"column":1129}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":89,"column":21},"generated":{"line":1,"column":1133}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":89,"column":26},"generated":{"line":1,"column":1138}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":89,"column":36},"generated":{"line":1,"column":1147}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":82,"column":22},"generated":{"line":1,"column":1150}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":83,"column":6},"generated":{"line":1,"column":1154}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":1,"column":1159}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":84,"column":6},"generated":{"line":1,"column":1177}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":84,"column":11},"generated":{"line":1,"column":1182}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":85,"column":6},"generated":{"line":1,"column":1199}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":85,"column":11},"generated":{"line":1,"column":1204}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":85,"column":26},"generated":{"line":1,"column":1217}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":86,"column":6},"generated":{"line":1,"column":1219}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":86,"column":11},"generated":{"line":1,"column":1224}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":86,"column":25},"generated":{"line":1,"column":1238}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":91,"column":4},"generated":{"line":1,"column":1243}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":91,"column":9},"generated":{"line":1,"column":1248}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":91,"column":29},"generated":{"line":1,"column":1261}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":91,"column":40},"generated":{"line":1,"column":1272}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":92,"column":6},"generated":{"line":1,"column":1277}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":92,"column":11},"generated":{"line":1,"column":1282}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":92,"column":19},"generated":{"line":1,"column":1290}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":92,"column":30},"generated":{"line":1,"column":1300}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":93,"column":7},"generated":{"line":1,"column":1305}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":93,"column":12},"generated":{"line":1,"column":1310}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":96,"column":2},"generated":{"line":1,"column":1319}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":96,"column":10},"generated":{"line":1,"column":1327}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":96,"column":26},"generated":{"line":1,"column":1329}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":97,"column":8},"generated":{"line":1,"column":1332}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":97,"column":13},"generated":{"line":1,"column":1337}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":6},"generated":{"line":1,"column":1347}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":11},"generated":{"line":1,"column":1352}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":19},"generated":{"line":1,"column":1360}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":28},"generated":{"line":1,"column":1369}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":33},"generated":{"line":1,"column":1374}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":43},"generated":{"line":1,"column":1383}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":45},"generated":{"line":1,"column":1384}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":45},"generated":{"line":1,"column":1391}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":53},"generated":{"line":1,"column":1393}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":98,"column":53},"generated":{"line":1,"column":1402}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":101,"column":2},"generated":{"line":1,"column":1406}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":102,"column":4},"generated":{"line":1,"column":1416}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":102,"column":9},"generated":{"line":1,"column":1421}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":103,"column":4},"generated":{"line":1,"column":1439}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":103,"column":9},"generated":{"line":1,"column":1444}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":106,"column":10},"generated":{"line":1,"column":1461}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":107,"column":9},"generated":{"line":1,"column":1479}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":107,"column":14},"generated":{"line":1,"column":1484}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":111,"column":4},"generated":{"line":1,"column":1494}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":111,"column":9},"generated":{"line":1,"column":1499}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":111,"column":17},"generated":{"line":1,"column":1507}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":111,"column":22},"generated":{"line":1,"column":1512}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":111,"column":27},"generated":{"line":1,"column":1517}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":111,"column":37},"generated":{"line":1,"column":1526}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":114,"column":10},"generated":{"line":1,"column":1530}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":115,"column":4},"generated":{"line":1,"column":1547}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":115,"column":17},"generated":{"line":1,"column":1560}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":115,"column":22},"generated":{"line":1,"column":1565}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":116,"column":4},"generated":{"line":1,"column":1579}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":116,"column":9},"generated":{"line":1,"column":1584}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":116,"column":24},"generated":{"line":1,"column":1602}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":119,"column":10},"generated":{"line":1,"column":1604}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":119,"column":24},"generated":{"line":1,"column":1619}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":120,"column":4},"generated":{"line":1,"column":1626}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":120,"column":10},"generated":{"line":1,"column":1628}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":121,"column":4},"generated":{"line":1,"column":1637}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":126,"column":4},"generated":{"line":1,"column":1641}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":126,"column":9},"generated":{"line":1,"column":1646}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":127,"column":7},"generated":{"line":1,"column":1655}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":127,"column":15},"generated":{"line":1,"column":1662}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":127,"column":21},"generated":{"line":1,"column":1665}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":127,"column":23},"generated":{"line":1,"column":1667}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":127,"column":34},"generated":{"line":1,"column":1676}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":128,"column":7},"generated":{"line":1,"column":1679}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":128,"column":16},"generated":{"line":1,"column":1687}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":128,"column":22},"generated":{"line":1,"column":1690}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":128,"column":24},"generated":{"line":1,"column":1692}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":128,"column":33},"generated":{"line":1,"column":1701}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":131,"column":10},"generated":{"line":1,"column":1705}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":131,"column":23},"generated":{"line":1,"column":1718}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":4},"generated":{"line":1,"column":1721}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":11},"generated":{"line":1,"column":1728}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":16},"generated":{"line":1,"column":1733}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":32},"generated":{"line":1,"column":1747}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":37},"generated":{"line":1,"column":1752}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":50},"generated":{"line":1,"column":1765}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":132,"column":61},"generated":{"line":1,"column":1774}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":1777}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":1785}},{"source":"../../../src/lib/push.ts","name":null,"original":{"line":134,"column":1},"generated":{"line":1,"column":1793}}],"sources":{"../../../src/lib/push.ts":"import { DEFAULT_TIMEOUT } from '../lib/constants'\nimport type RealtimeChannel from '../RealtimeChannel'\n\nexport default class Push {\n  sent: boolean = false\n  timeoutTimer: number | undefined = undefined\n  ref: string = ''\n  receivedResp: {\n    status: string\n    response: { [key: string]: any }\n  } | null = null\n  recHooks: {\n    status: string\n    callback: Function\n  }[] = []\n  refEvent: string | null = null\n  rateLimited: boolean = false\n\n  /**\n   * Initializes the Push\n   *\n   * @param channel The Channel\n   * @param event The event, for example `\"phx_join\"`\n   * @param payload The payload, for example `{user_id: 123}`\n   * @param timeout The push timeout in milliseconds\n   */\n  constructor(\n    public channel: RealtimeChannel,\n    public event: string,\n    public payload: { [key: string]: any } = {},\n    public timeout: number = DEFAULT_TIMEOUT\n  ) {}\n\n  resend(timeout: number) {\n    this.timeout = timeout\n    this._cancelRefEvent()\n    this.ref = ''\n    this.refEvent = null\n    this.receivedResp = null\n    this.sent = false\n    this.send()\n  }\n\n  send() {\n    if (this._hasReceived('timeout')) {\n      return\n    }\n    this.startTimeout()\n    this.sent = true\n    const status = this.channel.socket.push({\n      topic: this.channel.topic,\n      event: this.event,\n      payload: this.payload,\n      ref: this.ref,\n      join_ref: this.channel._joinRef(),\n    })\n    if (status === 'rate limited') {\n      this.rateLimited = true\n    }\n  }\n\n  updatePayload(payload: { [key: string]: any }): void {\n    this.payload = { ...this.payload, ...payload }\n  }\n\n  receive(status: string, callback: Function) {\n    if (this._hasReceived(status)) {\n      callback(this.receivedResp?.response)\n    }\n\n    this.recHooks.push({ status, callback })\n    return this\n  }\n\n  startTimeout() {\n    if (this.timeoutTimer) {\n      return\n    }\n    this.ref = this.channel.socket._makeRef()\n    this.refEvent = this.channel._replyEventName(this.ref)\n\n    const callback = (payload: any) => {\n      this._cancelRefEvent()\n      this._cancelTimeout()\n      this.receivedResp = payload\n      this._matchReceive(payload)\n    }\n\n    this.channel._on(this.refEvent, {}, callback)\n\n    this.timeoutTimer = <any>setTimeout(() => {\n      this.trigger('timeout', {})\n    }, this.timeout)\n  }\n\n  trigger(status: string, response: any) {\n    if (this.refEvent)\n      this.channel._trigger(this.refEvent, { status, response })\n  }\n\n  destroy() {\n    this._cancelRefEvent()\n    this._cancelTimeout()\n  }\n\n  private _cancelRefEvent() {\n    if (!this.refEvent) {\n      return\n    }\n\n    this.channel._off(this.refEvent, {})\n  }\n\n  private _cancelTimeout() {\n    clearTimeout(this.timeoutTimer)\n    this.timeoutTimer = undefined\n  }\n\n  private _matchReceive({\n    status,\n    response,\n  }: {\n    status: string\n    response: Function\n  }) {\n    this.recHooks\n      .filter((h) => h.status === status)\n      .forEach((h) => h.callback(response))\n  }\n\n  private _hasReceived(status: string) {\n    return this.receivedResp && this.receivedResp.status === status\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"2bdffb4c3eb6d26d006ba40228cae620","cacheData":{"env":{}}}